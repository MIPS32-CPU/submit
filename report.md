# 计算机组成原理 108组实验报告





## 1 项目简介

本项目是2018-2019秋季学期清华大学刘卫东老师计算机组成原理课程挑战组的实验项目。项目的设计要求、功能测例、监控程序和项目代码可以在？中找到。



### 1.1 项目成果

我们最终设计并实现了一个支持MIPS指令集的32位五级流水线CPU。具体功能包括：

* 支持共？条MIPS指令系统的基本指令

* 支持与CPU有关的异常、中断及TLB表查询
* 通过全部功能测例，并能运行监控程序，CPU主频达到50Mhz。

* 支持相关的扩展外设，包括RAM读写、flash读写、串口读写、VGA图像输出等

* 编写了一个汇编语言游戏程序（贪吃蛇），并在cpu上运行



### 1.2 开发过程简介

与普通组的“奋战三星期，造台计算机”不同，挑战组项目贯穿整个2018-2019秋季学期。我们在此过程中研精覃思，夜以继日，最终的设计目标才得以完成，可谓“千淘万漉虽辛苦，吹尽狂沙始到金”。

#### 1.2.1 组队及分工

本组（108组）的三名组员及相应分工如下：

|  姓名  | 班级 |    学号    | 分工 |
| :----: | :--: | :--------: | :--: |
| 丁相允 | 计65 | 2016011361 |  ？  |
| 尹一帆 | 计65 |     ？     |  ？  |
| 阎静雅 | 计65 |     ？     |  ？  |

#### 1.2.2 开发流程

1. 第1周至第4周：组队，项目前期调研（向往届学长学姐咨询），学习计算机系统基本知识，确定开发语言，确定实验目标，初步模块划分及任务分工。
2. 第5周至第7周：编写CPU的基本架构，支持MIPS基本指令，ram读写，相关代码调试。
3. 第8周至第10周：编写异常处理部分、中断相关部分、TLB，相关代码调试。
4. 第11周至第14周：编写各外设模块，各部分独立调试。
5. 第15周：各部分协同联调，编写贪吃蛇汇编程序，项目展示。

#### 1.2.3 开发环境

##### 开发语言

我们使用Verilog语言完成本项目的开发。

我们曾经试图使用Chisel（由伯克利大学开发的基于Scala的硬件开发框架）进行开发。经过最开始的尝试，我们总结了chisel的如下优缺点：

优点：提供抽象的数据类型和接口，使用面向对象的方法，能够批量端口连接，简化开发过程，能直接通过sbt（Scala Build Tools）编译成Verilog语言。

缺点：学习成本高（需要学习Scala和Chisel并配置相应环境），仍需要手动编写逻辑电路，在小型项目上优势不明显，不支持高阻态等（可以通过内嵌Verilog代码解决），编译后的代码注入thinpad_top框架后难以调试。

综合以上分析，我们最终还是选择了Verilog。

##### 开发工具

我们使用Vivado 2018.1作为IDE。Vivado提供了便捷的verilog编写和仿真工具，并能生成bitstream直接导入FPGA芯片中，且与thinpad_top平台兼容性好。

我们使用清华大学计算机系的32位开发板进行实验。同时我们也使用了更加方便的在线实验平台。



## 2 项目设计



### 2.1 指令系统

我们完成的cpu共支持？条指令。各指令的格式、功能如下：

（一个表格）



### 2.2 CPU设计图

（不会画。底下这个是别人的。）

![No Image](image/CPU.png)

+相关功能的说明



### 2.3 贪吃蛇游戏设计

（不会写。。）



## 3 CPU基本模块

我们的CPU采用单一时钟的设计，各模块均引入了clk（50Mhz时钟）和rst（1表示复位，0表示运行），在以后的各个模块中不再赘述。



### 3.1 PC



### 3.2 IF_ID



### 3.3 ID



### 3.4 registers



### 3.5 ID_EX



### 3.6 EX



### 3.7 EX_MEM



### 3.8 MEM



### 3.9 MEM_WB



### 3.10 HILO



### 3.11 div



## 4 CPU扩展模块



### 4.1 MMU



### 4.2 sram_control



### 4.3 uart_control



### 4.4 vga_control



### 4.5 flash



## 5 其他相关代码



### 5.1 thinpad_top中添加的代码



### 5.2 图片压缩



### 5.3 贪吃蛇汇编程序



## 6 实验成果展示



### 6.1 通过功能测例



### 6.2 运行监控程序



### 6.3 展示图片



### 6.4 贪吃蛇游戏



##7 实验总结